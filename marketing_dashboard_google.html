<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Innovator ETFs Marketing Calendar (Google Sheets)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" />
  <style>
    body { background-color: #f5f6fa; font-family: Arial, sans-serif; color: #333; }
    h2 { color: #002d38; font-weight: 600; }
    .sidebar { background-color: #002d38; color: #fff; padding: 20px; height: 100vh; overflow-y: auto; }
    .activation-card { border: none; margin-bottom: 1rem; }
    .activation-card .card-header { background-color: #003f4c; color: #fff; cursor: pointer; padding: 0.5rem 1rem; }
    .activation-card .card-body { background-color: #002d38; padding: 0; }
    .activation-card .list-group-item { background: transparent; border: none; color: #d0e4ec; padding: 0.25rem 1rem; }
    .activation-card .list-group-item:hover { background-color: rgba(255,255,255,0.1); }
    .color-dot { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 0.5rem; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <aside class="col-md-3 sidebar">
        <h2 class="mb-4">Activations</h2>
        <div id="activation-sections"></div>
      </aside>
      <main class="col-md-9 py-4">
        <h2 class="mb-3">Innovator ETFs Marketing Calendar</h2>
        <div id="calendar"></div>
      </main>
    </div>
  </div>
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const COLORS = ['#5D737E','#64B6AC','#C0D6DF','#C7B198','#A26769','#6B4226','#B2B1B9','#A99985','#77966D','#858ae3','#8e806a','#e9d5ca'];
    let colorMap = {};
    let globalEvents = [];
    let calendar;
    let selectedCategories = new Set();
    function initCalendar() {
      calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek' },
        height: 'auto',
        events: [],
        eventDidMount: info => {
          if (info.event.extendedProps.description) info.el.setAttribute('title', info.event.extendedProps.description);
        }
      });
      calendar.render();
    }
    function renderCalendarEvents() {
      calendar.getEvents().forEach(e => e.remove());
      const filtered = globalEvents.filter(evt => selectedCategories.size === 0 || selectedCategories.has(evt.title));
      filtered.forEach(evt => calendar.addEvent(evt));
    }
    function buildActivationSections(data) {
      const container = document.getElementById('activation-sections');
      container.innerHTML = '';
      const groups = {};
      data.forEach(row => {
        const cat = row['Item']?.toString().trim();
        const dateStr = row['Date'];
        if (!cat || !dateStr) return;
        if (!groups[cat]) groups[cat] = [];
        const date = new Date(dateStr);
        const desc = row['Description']?.toString().trim() || '';
        groups[cat].push({ date, desc });
      });
      const categories = Object.keys(groups).sort();
      let colorIndex = 0;
      categories.forEach(cat => {
        if (!colorMap[cat]) {
          colorMap[cat] = COLORS[colorIndex % COLORS.length];
          colorIndex++;
        }
        groups[cat].sort((a,b) => a.date - b.date);
        const eventsInCat = groups[cat];
        const sanitizedId = cat.replace(/[^a-zA-Z0-9]/g, '');
        const card = document.createElement('div');
        card.className = 'card activation-card';
        const header = document.createElement('div');
        header.className = 'card-header d-flex align-items-center';
        const cb = document.createElement('input');
        cb.type = 'checkbox'; cb.className = 'form-check-input me-2'; cb.dataset.category = cat;
        cb.onchange = function() { if (this.checked) selectedCategories.add(cat); else selectedCategories.delete(cat); renderCalendarEvents(); };
        header.appendChild(cb);
        const dot = document.createElement('span'); dot.className = 'color-dot'; dot.style.backgroundColor = colorMap[cat]; header.appendChild(dot);
        const title = document.createElement('h5'); title.className = 'mb-0'; title.textContent = cat; header.appendChild(title);
        card.appendChild(header);
        const collapse = document.createElement('div'); collapse.className = 'card-body collapse'; collapse.id = sanitizedId;
        const list = document.createElement('ul'); list.className = 'list-group list-group-flush';
        eventsInCat.forEach(ev => {
          const li = document.createElement('li'); li.className = 'list-group-item'; li.textContent = ev.date.toLocaleDateString('en-US') + ': ' + ev.desc; list.appendChild(li);
        });
        collapse.appendChild(list);
        header.onclick = () => collapse.classList.toggle('show');
        card.appendChild(collapse);
        container.appendChild(card);
      });
    }
    function buildCalendarEvents(data) {
      globalEvents = [];
      data.forEach(row => {
        const dateStr = row['Date'];
        const title = row['Item']?.toString().trim();
        const desc = row['Description']?.toString().trim() || '';
        if (!dateStr || !title) return;
        const d = new Date(dateStr);
        if (isNaN(d)) return;
        globalEvents.push({ title, start: d, color: colorMap[title] || '#4285F4', description: desc });
      });
      renderCalendarEvents();
    }
    function loadFromGoogleSheet(url) {
      fetch(url)
        .then(res => res.text())
        .then(text => {
          Papa.parse(text, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              const data = results.data;
              buildActivationSections(data);
              buildCalendarEvents(data);
              document.querySelectorAll('.activation-card input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
          });
        })
        .catch(err => console.error('Error loading Google Sheet:', err));
    }
    document.addEventListener('DOMContentLoaded', () => {
      initCalendar();
      // Replace the gid parameter if your sheet has multiple tabs. gid=0 refers to the first sheet.
      const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQVNjUPRjSIZIMOEMX_p5pYA7GPX6tkBra72f5rUuUCKz--LtTF7OkYQ5nrvmPoWDvQ0JKhMyFMzwKp/pub?gid=0&single=true&output=csv';
      loadFromGoogleSheet(sheetUrl);
    });
  </script>
</body>
</html>